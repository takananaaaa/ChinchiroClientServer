<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: 'BananaSlip';
            src: url('YDWbananaslipplus.otf') format('opentype');
        }

        body {
            font-family: 'BananaSlip', sans-serif;
            background-color: #f7e7ce;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        .boss-order { position: absolute; top: 20px; right: 20px; background: white; border: 2px solid #8b4513; padding: 10px; border-radius: 10px; }
        .boss-order-title { font-size: 0.8rem; border-bottom: 1px solid #ddd; margin-bottom: 5px; }
        .boss-user { font-size: 0.9rem; padding: 2px 5px; }
        .dice-container { display: flex; gap: 15px; margin-top: 50px; margin-bottom: 40px; }
        .dice { width: 80px; height: 80px; background: #ccc; border: 2px solid #555; display: flex; justify-content: center; align-items: center; font-size: 3rem; box-shadow: 4px 4px 0px rgba(0,0,0,0.1); }

        .roll-button { font-family: 'BananaSlip', sans-serif; background-color: #a7c1e1; border: 2px solid #555; border-radius: 10px; padding: 10px 30px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 0 #7a8ea6; margin-bottom: 60px; outline: none; }
        .roll-button:active { transform: translateY(2px); box-shadow: none; }
        .roll-button:disabled { background-color: #999 !important; cursor: not-allowed; opacity: 0.7; box-shadow: none; }

        .players-container { display: flex; justify-content: space-around; width: 100%; max-width: 1200px; }
        .player-card { width: 220px; text-align: left; }
        .bet-amount { font-size: 1.8rem; text-align: center; margin-bottom: 10px; color: #8b4513; }
        .status-box { border: 3px solid #000; background: white; padding: 10px; height: 140px; position: relative; }
        .is-boss { border-color: #d35b31; }
        .boss-label { position: absolute; top: -25px; right: -10px; background: #ffff00; padding: 2px 10px; font-size: 1rem; border: 1px solid #000; }
        .info-line { margin-bottom: 5px; font-size: 1.1rem; }

        .bet-input-area { margin-top: 10px; display: flex; gap: 5px; }
        .bet-input { font-family: 'BananaSlip', sans-serif; width: 60px; border: 2px solid #8b4513; border-radius: 5px; }
        .bet-btn { font-family: 'BananaSlip', sans-serif; background: #ffcc00; border: 1px solid #8b4513; cursor: pointer; border-radius: 5px; }

        #cutin-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85);
            display: none; justify-content: center; align-items: center;
            z-index: 1000; color: white;
        }
        .cutin-content { display: flex; align-items: center; gap: 40px; }
        .monkey-img { width: 900px; height: 650px; border: 8px solid white; object-fit: cover; }
        .yaku-text-vertical { font-size: 7rem; writing-mode: vertical-rl; text-orientation: upright; text-shadow: 4px 4px 0px #ffcc00; letter-spacing: 10px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="cutin-overlay">
    <div class="cutin-content">
        <div class="yaku-text-vertical" id="cutin-text-left">役名</div>
        <img src="fukurotenaga.jpg" id="monkey-photo" class="monkey-img" alt="演出画像">
        <div class="yaku-text-vertical" id="cutin-text-right">役名</div>
    </div>
</div>

<div class="boss-order">
    <div class="boss-order-title">ボスザル順</div>
    <div class="boss-user" id="order-0">ユーザA</div>
    <div class="boss-user">ユーザB</div>
    <div class="boss-user">ユーザC</div>
    <div class="boss-user">ユーザD</div>
</div>

<div class="dice-container">
    <div class="dice" id="dice-0">フ</div><div class="dice" id="dice-1">ク</div><div class="dice" id="dice-2">ロ</div>
    <div class="dice" id="dice-3">テ</div><div class="dice" id="dice-4">ナ</div><div class="dice" id="dice-5">ガ</div>
</div>

<button class="roll-button" id="rollButton" disabled>サイコロを振る</button>

<div class="players-container">
    <div class="player-card">
        <div class="bet-amount" id="my-bet-display">0バナナ</div>
        <div class="status-box is-boss">
            <div class="boss-label">ボスザル</div>
            <div class="info-line" id="my-yaku">役:</div>
            <div class="info-line" id="player-name-0">ユーザA</div>
            <div class="info-line">手もち:<span id="my-money">10000</span></div>

            <div class="bet-input-area" id="bet-area">
                <input type="number" id="bet-input" class="bet-input" value="100">
                <button class="bet-btn" onclick="submitBet()">賭ける</button>
            </div>
        </div>
    </div>

    <div class="player-card"><div class="bet-amount">100バナナ</div><div class="status-box"><div class="info-line">役:サル</div><div class="info-line">ユーザB</div><div class="info-line">手もち:100</div></div></div>
    <div class="player-card"><div class="bet-amount">100バナナ</div><div class="status-box"><div class="info-line">役:クロザル</div><div class="info-line">ユーザC</div><div class="info-line">手もち:1000</div></div></div>
    <div class="player-card"><div class="bet-amount">100バナナ</div><div class="status-box"><div class="info-line">役:ナガザル</div><div class="info-line">ユーザD</div><div class="info-line">手もち:10</div></div></div>
</div>

<script>
    const diceChars = ["フ", "ク", "ロ", "テ", "ナ", "ガ"];
    let shuffleInterval = null;
    const registeredName = "仮";

    window.onload = function() {
        updateUserName(registeredName);
        document.getElementById('rollButton').onclick = rollHandler;
    };

    function rollHandler() {
        if (!shuffleInterval) {
            onRollDiceButtonPressed();
        } else {
            const finalResult = [];
            for(let i=0; i<6; i++) {
                finalResult.push(diceChars[Math.floor(Math.random() * diceChars.length)]);
            }
            stopShuffle(finalResult);
        }
    }

    function submitBet() {
        const val = document.getElementById('bet-input').value;
        const myMoney = parseInt(document.getElementById('my-money').innerText);

        if (parseInt(val) > myMoney) {
            alert("バナナが足りないよ！");
            return;
        }

        document.getElementById('my-bet-display').innerText = val + "バナナ";
        document.getElementById('bet-area').classList.add('hidden');

        document.getElementById('rollButton').disabled = false;
    }

    function updateUserName(name) {
        document.getElementById('player-name-0').innerText = name;
        document.getElementById('order-0').innerText = name;
    }

    function onRollDiceButtonPressed() {
        const button = document.getElementById('rollButton');
        button.innerText = "停止！";
        shuffleInterval = setInterval(() => {
            for (let i = 0; i < 6; i++) {
                document.getElementById(`dice-${i}`).innerText = diceChars[Math.floor(Math.random() * diceChars.length)];
            }
        }, 50);
    }

    function stopShuffle(result) {
        clearInterval(shuffleInterval);
        shuffleInterval = null;
        document.getElementById('rollButton').innerText = "サイコロを振る";

        result.forEach((char, i) => {
            document.getElementById(`dice-${i}`).innerText = char;
        });

        const yakuName = judgeYaku(result);

        if(yakuName !== "役なし") {
            showCutIn(yakuName);
        } else {
            document.getElementById('my-yaku').innerText = "役:ザル（役なし）";
        }
    }

    function judgeYaku(diceArray) {
        const s = diceArray.join("");
        const set = new Set(diceArray);

        //フクロテナガザル
        if (set.size === 6) return "フクロテナガザル";

        //テナガザル
        if (s.includes("テ") && s.includes("ナ") && s.includes("ガ")) return "テナガザル";

        //クロザル
        if (s.includes("ク") && s.includes("ロ")) return "クロザル";

        //ナガザル
        if (s.includes("ナ") && s.includes("ガ")) return "ナガザル";

        return "役なし";
    }

    function showCutIn(name) {
        const overlay = document.getElementById('cutin-overlay');
        const photo = document.getElementById('monkey-photo');

        document.getElementById('cutin-text-left').innerText = name;
        document.getElementById('cutin-text-right').innerText = name;
        document.getElementById('my-yaku').innerText = "役:" + name;

        if (name === "フクロテナガザル") photo.src = "fukurotenaga.jpg";
        else if (name === "テナガザル") photo.src = "tenaga.jpg";
        else if (name === "クロザル") photo.src = "kuro.jpg";
        else if (name === "ナガザル") photo.src = "naga.jpg";

        overlay.style.display = 'flex';

        setTimeout(() => {
            overlay.style.display = 'none';
        }, 3000);
    }
</script>

</body>
</html>